<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>mirt example for mixture Rasch model with two classes</title>
<style type="text/css">
/**
 * Prism.s theme ported from highlight.js's xcode style
 */
pre code {
  padding: 1em;
}
.token.comment {
  color: #007400;
}
.token.punctuation {
  color: #999;
}
.token.tag,
.token.selector {
  color: #aa0d91;
}
.token.boolean,
.token.number,
.token.constant,
.token.symbol {
  color: #1c00cf;
}
.token.property,
.token.attr-name,
.token.string,
.token.char,
.token.builtin {
  color: #c41a16;
}
.token.inserted {
  background-color: #ccffd8;
}
.token.deleted {
  background-color: #ffebe9;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #9a6e3a;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #836c28;
}
.token.function,
.token.class-name {
  color: #DD4A68;
}
.token.regex,
.token.important,
.token.variable {
  color: #5c2699;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
</style>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
body, .footnotes, code { font-size: .9em; }
li li { font-size: .95em; }
*, *:before, *:after {
  box-sizing: inherit;
}
pre, img { max-width: 100%; }
pre, pre:hover {
  white-space: pre-wrap;
  word-break: break-all;
}
pre code {
  display: block;
  overflow-x: auto;
}
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre) > code, code[class] { background-color: #F8F8F8; }
code.language-undefined, pre > code:not([class]) {
  background-color: inherit;
  border: 1px solid #eee;
}
table {
  margin: auto;
  border-top: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color: #666;
  margin: 0;
  padding-left: 1em;
  border-left: 0.5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC .numbered li { list-style: none; }
#TOC .numbered { padding-left: 0; }
#TOC .numbered ul { padding-left: 1em; }
table, .body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.footnote-ref a::before { content: "["; }
.footnote-ref a::after { content: "]"; }
.footnotes::before {
  content: "";
  display: block;
  max-width: 20em;
}

@media print {
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  tr, img { page-break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  pre { white-space: pre; }
}
</style>
</head>
<body>
<div class="include-before">
</div>
<div class="frontmatter">
<div class="title"><h1>mirt example for mixture Rasch model with two classes</h1></div>
<div class="author"><h2></h2></div>
<div class="date"><h3></h3></div>
</div>
<div class="body">
<h1 id="mirt-example-for-mixture-rasch-model-with-two-classes">mirt example for mixture Rasch model with two classes</h1>
<p>Adapted from the <code>sirt</code> package examples (<code>data.read</code>).</p>
<pre><code class="language-r">library(mirt)

data(data.read, package='sirt')
dat &lt;- data.read

# raschmix (in psychomix)
mod8a &lt;- psychomix::raschmix(data= as.matrix(dat) , k = 2, scores = &quot;saturated&quot;)
</code></pre>
<pre><code>## Error in loadNamespace(x): there is no package called 'psychomix'
</code></pre>
<pre><code class="language-r">summary(mod8a)
</code></pre>
<pre><code>## Error in h(simpleError(msg, call)): error in evaluating the argument 'object' in selecting a method for function 'summary': object 'mod8a' not found
</code></pre>
<pre><code class="language-r"># mrm (in mRm)
mod8b &lt;- mRm::mrm(data.matrix=dat, cl=2)
</code></pre>
<pre><code>## Error in loadNamespace(x): there is no package called 'mRm'
</code></pre>
<pre><code class="language-r">mod8b$conv.to.bound
</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object 'mod8b' not found
</code></pre>
<pre><code class="language-r">plot(mod8b)
</code></pre>
<pre><code>## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mod8b' not found
</code></pre>
<pre><code class="language-r">print(mod8b)
</code></pre>
<pre><code>## Error in print(mod8b): object 'mod8b' not found
</code></pre>
<pre><code class="language-r"># mirt
#* define theta grid
theta.k &lt;- seq( -5 , 5 , len=9 )
TP &lt;- length(theta.k)
Theta &lt;- matrix( 0 , nrow=2*TP , ncol=4)
Theta[1:TP,1:2] &lt;- cbind(theta.k , 1 )
Theta[1:TP + TP,3:4] &lt;- cbind(theta.k , 1 )
Theta
</code></pre>
<pre><code>##        [,1] [,2]  [,3] [,4]
##  [1,] -5.00    1  0.00    0
##  [2,] -3.75    1  0.00    0
##  [3,] -2.50    1  0.00    0
##  [4,] -1.25    1  0.00    0
##  [5,]  0.00    1  0.00    0
##  [6,]  1.25    1  0.00    0
##  [7,]  2.50    1  0.00    0
##  [8,]  3.75    1  0.00    0
##  [9,]  5.00    1  0.00    0
## [10,]  0.00    0 -5.00    1
## [11,]  0.00    0 -3.75    1
## [12,]  0.00    0 -2.50    1
## [13,]  0.00    0 -1.25    1
## [14,]  0.00    0  0.00    1
## [15,]  0.00    0  1.25    1
## [16,]  0.00    0  2.50    1
## [17,]  0.00    0  3.75    1
## [18,]  0.00    0  5.00    1
</code></pre>
<pre><code class="language-r"># define model
I &lt;- ncol(dat) # I = 12
mirtmodel &lt;- mirt::mirt.model(&quot;
    F1a = 1-12 # slope
    F1b = 1-12 # difficulty
    F2a = 1-12 # slope
    F2b = 1-12 # difficulty
    CONSTRAIN = (1-12,a1),(1-12,a3)
&quot;)

# get initial parameter values
mod.pars &lt;- mirt::mirt(dat, model=mirtmodel , pars = &quot;values&quot;)

# set starting values for class specific item probabilities
mod.pars[ mod.pars$name == &quot;d&quot; ,&quot;value&quot; ] &lt;- 0
mod.pars[ mod.pars$name == &quot;d&quot; ,&quot;est&quot; ] &lt;- FALSE
mod.pars[ mod.pars$name == &quot;a1&quot; ,&quot;value&quot; ] &lt;- 1
mod.pars[ mod.pars$name == &quot;a3&quot; ,&quot;value&quot; ] &lt;- 1

# initial values difficulties
b1 &lt;- qlogis( colMeans(dat) )
mod.pars[ mod.pars$name == &quot;a2&quot; ,&quot;value&quot; ] &lt;- b1
mod.pars[ mod.pars$name == &quot;a4&quot; ,&quot;value&quot; ] &lt;- b1 + runif(I , -1 , 1)

#* define prior for mixed Rasch analysis
mixed_prior &lt;- function(Theta,Etable){
    NC &lt;- 2
    
     # number of theta classes
    TP &lt;- nrow(Theta) / NC
    prior1 &lt;- dnorm( Theta[1:TP,1] )
    prior1 &lt;- prior1 / sum(prior1)
    if ( is.null(Etable) ){
     prior &lt;- c( prior1 , prior1 ) }
    if ( ! is.null(Etable) ){
    prior &lt;- ( rowSums( Etable[ , seq(1,2*I,2)] ) +
    rowSums( Etable[,seq(2,2*I,2)]) )/I
    a1 &lt;- aggregate( prior , list( rep(1:NC , each=TP) ) , sum )
    a1[,2] &lt;- a1[,2] / sum( a1[,2])
    
    # print some information during estimation
    cat( paste0( &quot; Class proportions: &quot; ,
    paste0( round(a1[,2] , 3 ) , collapse= &quot; &quot; ) ) , &quot;\n&quot;)
    a1 &lt;- rep( a1[,2] , each=TP )
    
    # specify mixture of two normal distributions
    prior &lt;- a1*c(prior1,prior1)
    }
    prior &lt;- prior / sum(prior)
    return(prior)
}

#* estimate model
mod8c &lt;- mirt::mirt(dat, mirtmodel , pars=mod.pars , verbose=FALSE ,
technical = list( customTheta=Theta , customPriorFun = mixed_prior ) )
</code></pre>
<pre><code>## EM quadrature for high dimensional models are better handled
##                                  	with the &quot;QMCEM&quot; or &quot;MCEM&quot; method
</code></pre>
<pre><code>##  Class proportions: 0.564 0.436 
##  Class proportions: 0.565 0.435 
##  Class proportions: 0.563 0.437 
##  Class proportions: 0.552 0.448 
##  Class proportions: 0.536 0.464 
##  Class proportions: 0.517 0.483 
##  Class proportions: 0.495 0.505 
##  Class proportions: 0.477 0.523 
##  Class proportions: 0.461 0.539 
##  Class proportions: 0.431 0.569 
##  Class proportions: 0.414 0.586 
##  Class proportions: 0.399 0.601 
##  Class proportions: 0.361 0.639 
##  Class proportions: 0.345 0.655 
##  Class proportions: 0.331 0.669 
##  Class proportions: 0.305 0.695 
##  Class proportions: 0.292 0.708 
##  Class proportions: 0.281 0.719 
##  Class proportions: 0.25 0.75 
##  Class proportions: 0.24 0.76 
##  Class proportions: 0.233 0.767 
##  Class proportions: 0.226 0.774 
##  Class proportions: 0.219 0.781 
##  Class proportions: 0.213 0.787 
##  Class proportions: 0.188 0.812 
##  Class proportions: 0.179 0.821 
##  Class proportions: 0.172 0.828 
##  Class proportions: 0.164 0.836 
##  Class proportions: 0.158 0.842 
##  Class proportions: 0.152 0.848 
##  Class proportions: 0.135 0.865 
##  Class proportions: 0.13 0.87 
##  Class proportions: 0.127 0.873 
##  Class proportions: 0.117 0.883 
##  Class proportions: 0.114 0.886 
##  Class proportions: 0.112 0.888 
##  Class proportions: 0.106 0.894 
##  Class proportions: 0.103 0.897 
##  Class proportions: 0.101 0.899 
##  Class proportions: 0.096 0.904 
##  Class proportions: 0.094 0.906 
##  Class proportions: 0.093 0.907 
##  Class proportions: 0.089 0.911 
##  Class proportions: 0.088 0.912 
##  Class proportions: 0.088 0.912 
##  Class proportions: 0.087 0.913 
##  Class proportions: 0.087 0.913 
##  Class proportions: 0.087 0.913 
##  Class proportions: 0.087 0.913 
##  Class proportions: 0.086 0.914 
##  Class proportions: 0.086 0.914 
##  Class proportions: 0.085 0.915 
##  Class proportions: 0.085 0.915 
##  Class proportions: 0.084 0.916 
##  Class proportions: 0.084 0.916 
##  Class proportions: 0.084 0.916 
##  Class proportions: 0.084 0.916 
##  Class proportions: 0.084 0.916 
##  Class proportions: 0.084 0.916 
##  Class proportions: 0.083 0.917 
##  Class proportions: 0.083 0.917 
##  Class proportions: 0.083 0.917 
##  Class proportions: 0.082 0.918 
##  Class proportions: 0.081 0.919 
##  Class proportions: 0.08 0.92 
##  Class proportions: 0.079 0.921 
##  Class proportions: 0.076 0.924 
##  Class proportions: 0.074 0.926 
##  Class proportions: 0.073 0.927 
##  Class proportions: 0.072 0.928 
##  Class proportions: 0.071 0.929 
##  Class proportions: 0.071 0.929 
##  Class proportions: 0.07 0.93 
##  Class proportions: 0.07 0.93 
##  Class proportions: 0.07 0.93 
##  Class proportions: 0.07 0.93 
##  Class proportions: 0.07 0.93 
##  Class proportions: 0.07 0.93 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931 
##  Class proportions: 0.069 0.931
</code></pre>
<pre><code class="language-r">print(mod8c)
</code></pre>
<pre><code>## 
## Call:
## mirt::mirt(data = dat, model = mirtmodel, pars = mod.pars, verbose = FALSE, 
##     technical = list(customTheta = Theta, customPriorFun = mixed_prior))
## 
## Full-information item factor analysis with 4 factor(s).
## Converged within 1e-04 tolerance after 105 EM iterations.
## mirt version: 1.39.4 
## M-step optimizer: BFGS 
## EM acceleration: Ramsay 
## Number of rectangular quadrature: 18
## Latent density type: Gaussian 
## 
## Log-likelihood = -1921.524
## Estimated parameters: 48 
## AIC = 3895.048
## BIC = 3993.666; SABIC = 3911.195
## G2 (4069) = 741.08, p = 1
## RMSEA = 0, CFI = NaN, TLI = NaN
</code></pre>
<pre><code class="language-r"># Like in Model 7e, the number of estimated parameters must be included.
nest &lt;- as.integer(sum(mod.pars$est) + 1)

# two class proportions and therefore one probability is freely estimated.
#* extract item parameters
coef(mod8c, simplify=TRUE)
</code></pre>
<pre><code>## $items
##        a1      a2    a3     a4 d g u
## A1 11.519  16.200 0.982  2.046 0 0 1
## A2 11.519  14.268 0.982  1.291 0 0 1
## A3 11.519  14.305 0.982  0.311 0 0 1
## A4 11.519  13.243 0.982 -0.199 0 0 1
## B1 11.519  14.861 0.982  1.101 0 0 1
## B2 11.519  12.691 0.982  0.057 0 0 1
## B3 11.519  14.834 0.982  2.848 0 0 1
## B4 11.519  13.928 0.982  0.970 0 0 1
## C1 11.519  -6.951 0.982  4.433 0 0 1
## C2 11.519 -12.525 0.982  1.323 0 0 1
## C3 11.519  -7.048 0.982  2.779 0 0 1
## C4 11.519 -15.197 0.982  1.539 0 0 1
## 
## $means
## F1a F1b F2a F2b 
##   0   0   0   0 
## 
## $cov
##     F1a F1b F2a F2b
## F1a   1   0   0   0
## F1b   0   1   0   0
## F2a   0   0   1   0
## F2b   0   0   0   1
</code></pre>
<pre><code class="language-r">sessionInfo()
</code></pre>
<pre><code>## R version 4.2.2 Patched (2022-11-10 r83330)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.6 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats4    stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] mvtnorm_1.2-2   sirt_3.12-66    ltm_1.2-0       polycor_0.8-1  
## [5] msm_1.7         MASS_7.3-58.2   mirt_1.39.4     lattice_0.20-45
## [9] knitr_1.43     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.10          highr_0.10           compiler_4.2.2      
##  [4] dcurver_0.9.2        tools_4.2.2          evaluate_0.21       
##  [7] lifecycle_1.0.3      gtable_0.3.3         nlme_3.1-162        
## [10] mgcv_1.8-41          rlang_1.1.1          Matrix_1.5-3        
## [13] cli_3.6.1            rstudioapi_0.14      commonmark_1.9.0    
## [16] parallel_4.2.2       TAM_4.1-4            expm_0.999-7        
## [19] xfun_0.39            gridExtra_2.3        cluster_2.1.4       
## [22] admisc_0.32          grid_4.2.2           glue_1.6.2          
## [25] pbapply_1.7-0        survival_3.4-0       CDM_8.2-6           
## [28] GPArotation_2023.3-1 splines_4.2.2        mime_0.12           
## [31] permute_0.9-7        Deriv_4.1.3          markdown_1.7        
## [34] vegan_2.6-4
</code></pre>
</div>
<div class="include-after">
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</body>
</html>
